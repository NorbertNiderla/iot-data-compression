#include <stdio.h>
#include <math.h>
#include <stdbool.h>

#include "../../../../compression_iot/archive/source/board_2_dim/distribution.h"
#include "../../../../compression_iot/archive/source/board_2_dim/entropy.h"
#include "../../../../compression_iot/archive/source/board_2_dim/fire.h"
#include "../../../../compression_iot/archive/source/board_2_dim/huffman.h"
#include "../../../../compression_iot/archive/source/board_2_dim/my_lib.h"
#include "../../../../compression_iot/archive/source/board_2_dim/rice.h"
#include "../../../../compression_iot/archive/source/board_2_dim/sprintz.h"
#include "../../../../compression_iot/archive/source/board_2_dim/tans.h"
#include "xtimer.h"

//#define DATA_PH
//#define DATA_TEMP
#define DATA_CONDUCT

#define FIRE_RICE_TANS
//#define SPRINTZ
//#define FIRE_RICE
//#define FIRE_TANS


#ifdef DATA_PH
const int data[640] = {782,
783, 783, 783, 783, 783, 783, 783, 783, 782, 782, 782, 783, 783, 783, 783, 783, 783, 783, 782, 782, 783, 783, 783, 783, 782, 782, 781, 781, 782, 783, 783, 783,
787, 791, 788, 784, 782, 781, 780, 780, 781, 782, 783, 783, 782, 781, 780, 781, 781, 781, 781, 781, 781, 781, 780, 781, 780, 781, 781, 781, 781, 781, 781, 781,
781, 781, 780, 780, 781, 781, 781, 781, 781, 782, 782, 781, 781, 781, 780, 780, 780, 780, 780, 780, 780, 780, 781, 781, 780, 780, 780, 781, 780, 780, 781, 780,
780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780,
780, 780, 780, 780, 780, 779, 780, 780, 779, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 781, 781, 780, 780, 780,
780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 781, 781, 780, 780, 780,
780, 780, 781, 781, 780, 780, 781, 780, 780, 780, 780, 780, 780, 781, 781, 781, 780, 780, 781, 781, 780, 780, 780, 781, 781, 780, 780, 780, 780, 781, 780, 780,
781, 781, 780, 780, 780, 780, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781,
781, 781, 781, 781, 781, 781, 781, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781,
781, 781, 781, 781, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 783, 783, 783, 783, 783,
783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783, 783,
783, 783, 783, 783, 783, 783, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785,
785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785, 785,
785, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 784, 783, 783, 783, 783,
783, 783, 783, 783, 783, 783, 783, 783, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 782, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781, 781,
781, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 780, 779, 779, 779, 779, 779, 779, 779, 779, 779, 779, 779, 779, 778, 778, 778,
778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 778, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777,
777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 776, 776, 776, 776, 776, 776, 776, 776, 776,
776, 776, 776, 776, 776, 776, 776, 776, 776, 776, 776, 776, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777,
777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 777, 778, 778, 778, 778};
#endif

#ifdef DATA_TEMP
const int data[640] = {1832,
1832, 1833, 1832, 1832, 1833, 1833, 1833, 1832, 1831, 1832, 1833, 1833, 1833, 1833, 1833, 1832, 1831, 1832, 1832, 1832, 1833, 1833, 1832, 1832, 1833, 1832, 1831, 1832, 1833, 1833, 1833, 1833,
1833, 1833, 1832, 1832, 1832, 1832, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1832, 1831, 1831, 1831, 1831, 1832, 1832, 1832, 1833, 1832, 1831, 1831, 1832, 1833, 1832, 1832, 1832,
1831, 1831, 1831, 1832, 1832, 1832, 1832, 1832, 1832, 1831, 1831, 1831, 1831, 1832, 1832, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1832, 1832, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1830, 1830, 1831, 1831, 1831, 1831, 1831,
1831, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830,
1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1831, 1830, 1830, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1832, 1832, 1831, 1832, 1833, 1832, 1832, 1833, 1833, 1833, 1833, 1833, 1833, 1832, 1832, 1833, 1833, 1833, 1833, 1833,
1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1833, 1832, 1833, 1832, 1833, 1832, 1833, 1833, 1833, 1832, 1832,
1833, 1833, 1833, 1833, 1833, 1832, 1832, 1833, 1832, 1831, 1832, 1832, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1830, 1831, 1830, 1831, 1830, 1831, 1830, 1831, 1830, 1831, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830,
1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830,
1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830,
1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1831, 1831, 1831, 1831, 1831, 1831, 1830, 1830, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831,
1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1831, 1830, 1830, 1830, 1831,
1830, 1831, 1830, 1831, 1830, 1831, 1830, 1831, 1830, 1830, 1830, 1830, 1831, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1830, 1831, 1831, 1830, 1830, 1830, 1830, 1830, 1830};
#endif

#ifdef DATA_CONDUCT
const int data[640] = {18879,
18879, 18882, 18882, 18879, 18879, 18879, 18879, 18882, 18882, 18882, 18882, 18882, 18882, 18882, 18882, 18882, 18882, 18879, 18879, 18879, 18879, 18879, 18879, 18875, 18875, 18871, 18871, 18871, 18868, 18868, 18864, 18864,
18868, 18882, 18889, 18893, 18893, 18896, 18896, 18893, 18893, 18896, 18907, 18911, 18907, 18900, 18896, 18889, 18886, 18882, 18886, 18889, 18893, 18893, 18893, 18893, 18893, 18886, 18879, 18871, 18864, 18861, 18861, 18857,
18854, 18854, 18850, 18847, 18843, 18843, 18843, 18839, 18836, 18829, 18822, 18818, 18815, 18811, 18811, 18811, 18811, 18808, 18801, 18779, 18758, 18741, 18727, 18713, 18702, 18695, 18688, 18681, 18678, 18674, 18671, 18667,
18657, 18650, 18646, 18643, 18643, 18639, 18639, 18643, 18643, 18643, 18643, 18639, 18636, 18629, 18622, 18619, 18612, 18605, 18598, 18591, 18591, 18587, 18584, 18577, 18574, 18570, 18567, 18567, 18567, 18567, 18563, 18560,
18560, 18560, 18556, 18556, 18556, 18556, 18553, 18549, 18543, 18539, 18543, 18546, 18549, 18553, 18553, 18549, 18543, 18536, 18536, 18539, 18539, 18539, 18543, 18543, 18543, 18543, 18536, 18536, 18536, 18539, 18543, 18543,
18546, 18549, 18556, 18560, 18563, 18567, 18574, 18574, 18574, 18574, 18580, 18587, 18591, 18594, 18598, 18601, 18605, 18608, 18612, 18619, 18622, 18629, 18636, 18639, 18646, 18650, 18657, 18660, 18664, 18667, 18671, 18664,
18657, 18660, 18664, 18667, 18671, 18667, 18664, 18653, 18643, 18639, 18639, 18636, 18636, 18639, 18646, 18650, 18660, 18671, 18674, 18678, 18685, 18692, 18695, 18699, 18695, 18695, 18702, 18713, 18730, 18744, 18755, 18765,
18772, 18779, 18790, 18801, 18808, 18808, 18811, 18818, 18829, 18836, 18839, 18843, 18843, 18850, 18857, 18861, 18861, 18864, 18868, 18875, 18879, 18882, 18893, 18904, 18914, 18921, 18936, 18947, 18950, 18954, 18954, 18961,
18961, 18961, 18968, 18972, 18975, 18975, 18979, 18986, 18993, 19004, 19008, 19004, 19004, 19008, 19015, 19026, 19033, 19037, 19040, 19044, 19048, 19051, 19055, 19062, 19073, 19080, 19088, 19091, 19095, 19091, 19091, 19091,
19095, 19095, 19095, 19091, 19095, 19099, 19102, 19102, 19102, 19095, 19088, 19084, 19080, 19077, 19073, 19069, 19062, 19059, 19055, 19048, 19033, 19022, 19022, 19022, 19019, 19015, 19015, 19011, 19011, 19011, 19011, 19011,
19008, 19001, 18993, 18986, 18986, 18983, 18979, 18972, 18972, 18972, 18972, 18972, 18968, 18965, 18957, 18950, 18943, 18929, 18911, 18900, 18893, 18889, 18886, 18879, 18871, 18868, 18868, 18864, 18861, 18854, 18843, 18832,
18822, 18818, 18811, 18801, 18790, 18779, 18769, 18758, 18748, 18744, 18741, 18737, 18734, 18723, 18713, 18702, 18695, 18688, 18674, 18657, 18650, 18653, 18653, 18653, 18650, 18643, 18639, 18636, 18629, 18622, 18608, 18594,
18580, 18563, 18549, 18543, 18536, 18525, 18508, 18498, 18495, 18498, 18498, 18498, 18498, 18498, 18498, 18501, 18501, 18498, 18495, 18491, 18488, 18484, 18477, 18471, 18464, 18454, 18443, 18437, 18433, 18430, 18426, 18423,
18420, 18413, 18413, 18413, 18416, 18413, 18409, 18403, 18396, 18386, 18376, 18372, 18369, 18365, 18362, 18359, 18352, 18349, 18342, 18332, 18325, 18328, 18332, 18339, 18339, 18332, 18325, 18328, 18332, 18332, 18335, 18339,
18342, 18342, 18339, 18342, 18345, 18349, 18349, 18345, 18339, 18332, 18328, 18322, 18318, 18318, 18315, 18312, 18305, 18298, 18292, 18282, 18275, 18268, 18262, 18255, 18248, 18235, 18225, 18215, 18208, 18205, 18208, 18212,
18215, 18212, 18205, 18205, 18215, 18218, 18222, 18215, 18205, 18195, 18188, 18182, 18175, 18179, 18185, 18192, 18202, 18212, 18222, 18232, 18238, 18252, 18262, 18275, 18285, 18292, 18298, 18302, 18305, 18305, 18312, 18318,
18325, 18328, 18332, 18335, 18339, 18345, 18349, 18349, 18352, 18359, 18359, 18355, 18349, 18342, 18339, 18332, 18328, 18328, 18328, 18332, 18335, 18339, 18342, 18345, 18349, 18352, 18349, 18345, 18339, 18339, 18339, 18335,
18332, 18332, 18332, 18339, 18355, 18369, 18376, 18382, 18386, 18396, 18399, 18403, 18420, 18447, 18474, 18501, 18525, 18546, 18563, 18574, 18584, 18591, 18594, 18601, 18605, 18608, 18615, 18619, 18622, 18629, 18632, 18632,
18629, 18629, 18636, 18646, 18657, 18667, 18674, 18678, 18681, 18681, 18685, 18688, 18699, 18709, 18713, 18720, 18720, 18723, 18727, 18727, 18723, 18720, 18720, 18716, 18713, 18709, 18709, 18709, 18709, 18706, 18699, 18688,
18674, 18667, 18657, 18653, 18657, 18660, 18664, 18671, 18671, 18671, 18667, 18664, 18664, 18667, 18667, 18671, 18674, 18678, 18674, 18671, 18671, 18667, 18664, 18653, 18639, 18625, 18612, 18605, 18608, 18608};
#endif

#define BUFFER_SIZE 128

int main(void){
#ifdef FIRE_RICE_TANS

	//int result[64]={0};
	xtimer_ticks32_t one;
	xtimer_ticks32_t two;
	xtimer_ticks32_t sum_time;

 	int int_buffer[BUFFER_SIZE] = {0};
	unsigned char char_buffer[BUFFER_SIZE] = {0};

	int stack_n[] = {5,16,64};

	for(int k_tab = 0; k_tab<3;k_tab++){
		int sum_bits = 0;
		sum_time.ticks32 = 0;
		int idx = 0;
		resetFire();
		while(idx<640){
			one = xtimer_now();

			fireEncode(&data[idx],stack_n[k_tab],int_buffer);
			riceEncode(int_buffer, stack_n[k_tab], int_buffer);
			int tans_bits = tansEncode(int_buffer,stack_n[k_tab],char_buffer,BUFFER_SIZE, true, 1);

			two = xtimer_now();

			sum_bits += tans_bits;
			sum_time.ticks32 += xtimer_diff(two,one).ticks32;

			clearCharArray(char_buffer,BUFFER_SIZE);
			clearIntArray(int_buffer,BUFFER_SIZE);
			idx += stack_n[k_tab];
		}
		printf("%d %d %ld\n", stack_n[k_tab], sum_bits, sum_time.ticks32);
	}
#endif
#ifdef SPRINTZ
		xtimer_ticks32_t one;
		xtimer_ticks32_t two;
		xtimer_ticks32_t sum_time;
		int stack_n[] = {5,16,64};//,128,128,128};

		for(int k_tab = 0; k_tab<3;k_tab++){
			int sum_bits = 0;
			sum_time.ticks32 = 0;
			int idx = 0;
			unsigned char char_buffer[BUFFER_SIZE] = {0};
			resetFire();
			resetDensCounter();

	while(idx<640){

		one = xtimer_now();
		int bytes = sprintzEncode(&data[idx],stack_n[k_tab],char_buffer,BUFFER_SIZE, true);
		two = xtimer_now();

		clearCharArray(char_buffer,BUFFER_SIZE);
		idx += stack_n[k_tab];
		sum_bits += bytes*8;
		sum_time.ticks32 += xtimer_diff(two,one).ticks32;
	}

	//printf("\nEncoding time: %lu\n",sum_time.ticks32);
	//printf("Sum of bits: %d\n", sum_bits);
	//printf("%2d %3d %6ld\n",stack_n[k_tab], table_n[k_tab],sum_time.ticks32);

	//printf("%d %d %d %ld %d %d %d\n",stack_n[k_tab], table_n[k_tab], sum_bits, sum_time.ticks32,GetFireTime(),GetBitpackingTime(),GetHuffmanTime());
	//printf("%d %d %d %ld\n",stack_n[k_tab], table_n[k_tab], sum_bits, sum_time.ticks32);
	printf("%d %d %ld\n", stack_n[k_tab], sum_bits, sum_time.ticks32);

	}
	//printSprintzHist();
	return 0;

#endif
#ifdef FIRE_RICE

	xtimer_ticks32_t one;
	xtimer_ticks32_t two;
	xtimer_ticks32_t sum_time;

 	int int_buffer[BUFFER_SIZE] = {0};
	unsigned char char_buffer[BUFFER_SIZE] = {0};
	int stack_n[] = {5,16,64};

	for(int k_tab = 0; k_tab<3;k_tab++){
		int sum_bits = 0;
		sum_time.ticks32 = 0;
		int idx = 0;
		resetFire();
		while(idx<640){
			one = xtimer_now();

			fireEncode(&data[idx],stack_n[k_tab],int_buffer);
			int bits = riceEncode(int_buffer, stack_n[k_tab], char_buffer,BUFFER_SIZE);

			two = xtimer_now();

			sum_bits += bits;
			sum_time.ticks32 += xtimer_diff(two,one).ticks32;

			clearCharArray(char_buffer,BUFFER_SIZE);
			clearIntArray(int_buffer,BUFFER_SIZE);
			idx += stack_n[k_tab];
		}
		printf("%d %d %ld\n", stack_n[k_tab], sum_bits, sum_time.ticks32);
	}

#endif
#ifdef FIRE_TANS
	xtimer_ticks32_t one;
	xtimer_ticks32_t two;
	xtimer_ticks32_t sum_time;

 	int int_buffer[BUFFER_SIZE] = {0};
	unsigned char char_buffer[BUFFER_SIZE] = {0};

	int stack_n[] = {5,16,64};

	for(int k_tab = 0; k_tab<3;k_tab++){
		int sum_bits = 0;
		sum_time.ticks32 = 0;
		int idx = 0;
		resetFire();
		while(idx<640){
			one = xtimer_now();

			fireEncode(&data[idx],stack_n[k_tab],int_buffer);
			zigzag(int_buffer, stack_n[k_tab]);
			for(int c = 0; c<stack_n[k_tab]; c++) if(int_buffer[c]>255) int_buffer[c] = 0;
			int tans_bits = tansEncode(int_buffer,stack_n[k_tab],char_buffer,BUFFER_SIZE, true, 0);

			two = xtimer_now();

			sum_bits += tans_bits;
			sum_time.ticks32 += xtimer_diff(two,one).ticks32;

			clearCharArray(char_buffer,BUFFER_SIZE);
			clearIntArray(int_buffer,BUFFER_SIZE);
			idx += stack_n[k_tab];
		}
		printf("%d %d %ld\n", stack_n[k_tab], sum_bits, sum_time.ticks32);
	}
#endif
}
